


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <title>Rental Property Calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin-top: 3rem;
        }
    </style>

    <!-- Custom CSS Stylesheet Link -->
    <link rel="stylesheet" href="css/calc-style.css">
</head>

<body>
    <div class="ms-cl" id="mx_cl">
        <div class="container">
            <div class="all-body">
                <div class="row">
                    <div class="col-md-12">
                        <h3 class="top-title">Rental Property Calculator</h3>
                        <div class="section-row">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <label for="in_1" class="left-sub-heading">Purchase Price</label>
                                        <input type="text" class="form-control sp-left cl-input in-curr" id="in_1"
                                            value="200000" autocomplete="off">
                                        <span class="prepend-text">$</span>
                                    </div>
                                    
                                    <div class="form-group">
                                        <div class="left-sub-heading sub-heading-hr">Loan:</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xmd-6">
                                            <label>Use Loan?</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-group">
                                                <div class="option-sec">
                                                    <div data-value="Yes" class="option-item loan-option is-active">Yes</div>
                                                    <div data-value="No" class="option-item loan-option">No</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6 loan-elm">
                                            <label for="in_101">Down Payment</label>
                                        </div>
                                        <div class="col-xmd-6 loan-elm">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                    id="in_101" value="20" autocomplete="off">
                                                <span class="append-text">%</span>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6 loan-elm">
                                            <label for="in_102">Interest Rate</label>
                                        </div>
                                        <div class="col-xmd-6 loan-elm">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                    id="in_102" value="6" autocomplete="off">
                                                <span class="append-text">%</span>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6 loan-elm">
                                            <label for="in_103">Loan Term</label>
                                        </div>
                                        <div class="col-xmd-6 loan-elm">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input"
                                                    id="in_103" value="30" autocomplete="off">
                                                <span class="append-text">year</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="left-sub-heading sub-heading-hr">Income:</label>
                                    </div>
                                    <div class="row right-mid">
                                        <div class="col-xmd-6"></div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div></div>
                                                <div class="col-label">Annual Increase</div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_2">Monthly Rent</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-left cl-input in-curr"
                                                        id="in_2" value="2000" autocomplete="off">
                                                    <span class="prepend-text">$</span>
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                        id="in_2_up" value="3" autocomplete="off">
                                                    <span class="append-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_6">Vacancy Rate</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                    id="in_6" value="5" autocomplete="off">
                                                <span class="append-text">%</span>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_66">Maintenance Fee</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                    id="in_66" value="0" autocomplete="off">
                                                <span class="append-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="left-sub-heading sub-heading-hr">Expense:</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xmd-6"></div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="col-label">Annual</div>
                                                <div class="col-label">Annual Increase</div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_3">Property Tax</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-left cl-input in-curr"
                                                        id="in_3" value="3000" autocomplete="off">
                                                    <span class="prepend-text">$</span>
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                        id="in_3_up" value="3" autocomplete="off">
                                                    <span class="append-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_4">Total Insurance</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-left cl-input in-curr"
                                                        id="in_4" value="1200" autocomplete="off">
                                                    <span class="prepend-text">$</span>
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                        id="in_4_up" value="3" autocomplete="off">
                                                    <span class="append-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_5">HOA Fee</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-left cl-input in-curr"
                                                        id="in_5" value="0" autocomplete="off">
                                                    <span class="prepend-text">$</span>
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                        id="in_5_up" value="3" autocomplete="off">
                                                    <span class="append-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_55">Maintenance Fee</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-left cl-input in-curr"
                                                        id="in_55" value="2000" autocomplete="off">
                                                    <span class="prepend-text">$</span>
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                        id="in_55_up" value="3" autocomplete="off">
                                                    <span class="append-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_7">Other Costs</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-flex">
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-left cl-input in-curr"
                                                        id="in_7" value="500" autocomplete="off">
                                                    <span class="prepend-text">$</span>
                                                </div>
                                                <div class="input-group">
                                                    <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                        id="in_7_up" value="3" autocomplete="off">
                                                    <span class="append-text">%</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="left-sub-heading sub-heading-hr">Sell:</div>
                                    </div>
                                    <div class="row">
                                        <div class="col-xmd-6">
                                            <label>Do You Know the Sell Price?</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-group">
                                                <div class="option-sec">
                                                    <div data-value="Yes" class="option-item sell-option is-active">Yes</div>
                                                    <div data-value="No" class="option-item sell-option">No</div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6 con-1">
                                            <label for="in_8">Sell Price</label>
                                        </div>
                                        <div class="col-xmd-6 con-1">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-left cl-input in-curr"
                                                    id="in_8" value="400000" autocomplete="off">
                                                <span class="prepend-text">$</span>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6 con-2 ds-none">
                                            <label for="in_9">Annual Value Appreciation</label>
                                        </div>
                                        <div class="col-xmd-6 con-2 ds-none">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                    id="in_9" value="3" autocomplete="off">
                                                <span class="append-text">%</span>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_10">Holding Length</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input"
                                                    id="in_10" value="20" autocomplete="off">
                                                <span class="append-text">year</span>
                                            </div>
                                        </div>
                                        <div class="col-xmd-6">
                                            <label for="in_11">Cost to Sell</label>
                                        </div>
                                        <div class="col-xmd-6">
                                            <div class="input-group">
                                                <input type="text" class="form-control sp-right cl-input in-prcnt"
                                                    id="in_11" value="8" autocomplete="off">
                                                <span class="append-text">%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="right-section">
                                        <h3 class="rs-sub-title">First Year Income and Expense:</h3>
                                        <div style="overflow-x: auto;">
                                            <table class="table">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th style="border-bottom: 1px solid #00af92 !important;">Monthly</th>
                                                        <th style="border-bottom: 1px solid #00af92 !important;">Annual</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td nowrap>Income:</td>
                                                        <td id="rsl_11">$0.00</td>
                                                        <td id="rsl_12">$0.00</td>
                                                    </tr>
                                                    <tr nowrap id="mrt_con">
                                                        <td>Mortgage Pay:</td>
                                                        <td id="rsl_21">$0.00</td>
                                                        <td id="rsl_22">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Vacancy (<span id="vc_rate">5</span>%):</td>
                                                        <td id="rsl_31">$0.00</td>
                                                        <td id="rsl_32">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Property Tax:</td>
                                                        <td id="rsl_41">$0.00</td>
                                                        <td id="rsl_42">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Total Insurance:</td>
                                                        <td id="rsl_51">$0.00</td>
                                                        <td id="rsl_52">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Maintenance Cost:</td>
                                                        <td id="rsl_61">$0.00</td>
                                                        <td id="rsl_62">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Other Cost:</td>
                                                        <td id="rsl_71">$0.00</td>
                                                        <td id="rsl_72">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Cash Flow:</td>
                                                        <td id="rsl_81">$0.00</td>
                                                        <td id="rsl_82">$0.00</td>
                                                    </tr>
                                                    <tr>
                                                        <td nowrap>Net Operating Income (NOI):</td>
                                                        <td id="rsl_91">$0.00</td>
                                                        <td id="rsl_92">$0.00</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>                                    
                                </div>
                                <div class="col-md-6">
                                    <div class="right-section" style="height: 100%;">
                                        <h3 class="rs-sub-title">For the 20 Years Invested:</h3>
                                        <div style="overflow-x: auto;">
                                            <table class="table">
                                                <tr>
                                                    <td nowrap>Return (IRR):</td>
                                                    <td class="sp-rs-vl" id="rs_1">$0.00</td>
                                                </tr>
                                                <tr>
                                                    <td nowrap>Total Profit when Sold:</td>
                                                    <td class="sp-rs-vl" id="rs_2">$0.00</td>
                                                </tr>
                                                <tr>
                                                    <td nowrap>Cash on Cash Return:</td>
                                                    <td class="sp-rs-vl" id="rs_3">$0.00</td>
                                                </tr>
                                                <tr>
                                                    <td nowrap>Capitalization Rate:</td>
                                                    <td class="sp-rs-vl" id="rs_4">$0.00</td>
                                                </tr>
                                                <tr>
                                                    <td nowrap>Total Rental Income:</td>
                                                    <td id="rs_5">$0.00</td>
                                                </tr>
                                                <tr>
                                                    <td nowrap>Total Expenses:</td>
                                                    <td id="rs_6">$0.00</td>
                                                </tr>
                                                <tr>
                                                    <td nowrap>Total Net Operating Income</td>
                                                    <td id="rs_7">$0.00</td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <br>
                                    <div class="left-sub-heading sub-heading-hr">Breakdown Over Time:</div>
                                    <div style="overflow-x: auto;">
                                        <table class="table rs-table">
                                            <thead>
                                                <tr style="background-color: #defffa;">
                                                    <th rowspan="2">Year</th>
                                                    <th rowspan="2">Annual Income</th>
                                                    <th rowspan="2">Mortgage</th>
                                                    <th rowspan="2">Expenses</th>
                                                    <th rowspan="2">Cash Flow</th>
                                                    <th rowspan="2">Cash on Cash Return</th>
                                                    <th rowspan="2">Equity Accumulated</th>
                                                    <th colspan="2">If Sold at Year End</th>
                                                </tr>
                                                <tr style="background-color: #defffa;">
                                                    <th style="border-bottom: 1px solid #cccccc !important;">Cash to Receive</th>
                                                    <th style="border-bottom: 1px solid #cccccc !important;">Return (IRR)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tb_data">
    
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/autonumeric@4.8.1"></script>
    <script>
        jQuery(($) => {
            let ins = {}, mn_fee_type = "dollar", i, y, useLoan = "Yes";
            let flat_vl = false, is_prcnt = true, know_sell_price = "Yes";

            const numOptionCurrency = {
                digitGroupSeparator: ',',
                decimalCharacter: '.',
                decimalCharacterAlternative: '.',
                currencySymbol: '',
                currencySymbolPlacement: AutoNumeric.options.currencySymbolPlacement.prefix,
                decimalPlaces: 0,
                minimumValue: 0,
                maximumValue: 99999999999
            };

            const numOptionPercent = {
                digitGroupSeparator: ',',
                decimalCharacter: '.',
                decimalCharacterAlternative: '.',
                currencySymbol: '',
                currencySymbolPlacement: AutoNumeric.options.currencySymbolPlacement.suffix,
                decimalPlaces: 2,
                minimumValue: 0,
                maximumValue: 100
            };

            const nft = Intl.NumberFormat("en-US", {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            });

            const nftd = Intl.NumberFormat("en-US", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });

            const anElement1 = AutoNumeric.multiple('.in-curr', numOptionCurrency);
            const anElement2 = AutoNumeric.multiple('.in-prcnt', numOptionPercent);
            const elm4 = new AutoNumeric('#in_55', numOptionCurrency);

            get_vl();

            $(".option-btn-2").on("click", function () {
                $(".option-btn-2").removeClass("is-active");
                $(this).addClass("is-active");
                mn_fee_type = $(this).data("value");

                if (mn_fee_type == "dollar") {
                    elm4.set(0);
                    elm4.update(numOptionCurrency);
                } else {
                    elm4.set(0);
                    elm4.update(numOptionPercent);
                }
                get_vl();
            });

            $(".sell-option").on("click", function () {
                $(".sell-option").removeClass("is-active");
                $(this).addClass("is-active");
                know_sell_price = $(this).data("value");

                if(know_sell_price == "Yes"){
                    $(".con-1").removeClass("ds-none");
                    $(".con-2").addClass("ds-none");
                } else {
                    $(".con-1").addClass("ds-none");
                    $(".con-2").removeClass("ds-none");
                }
                get_vl();
            });
            $(".loan-option").on("click", function () {
                $(".loan-option").removeClass("is-active");
                $(this).addClass("is-active");
                useLoan = $(this).data("value");

                if(useLoan == "Yes"){
                    $(".loan-elm").removeClass("ds-none");
                    $("#mrt_con").removeClass("ds-none");
                } else {
                    $(".loan-elm").addClass("ds-none");
                    $("#mrt_con").addClass("ds-none");
                }
                get_vl();
            });

            $("#in_55").on("input", function () {
                flat_vl = false;
                is_prcnt = true;
                get_vl();
            });
            
            $(".cl-input").on("input", function () {
                get_vl();
            });

            function get_vl() {
                $(".cl-input").each(function (i, elm) {
                    let vl = removeSign($(elm).val());
                    let inID = $(elm).attr("id");

                    if ($(elm).hasClass("in-prcnt")) {
                        vl = vl / 100;
                    }

                    ins[inID] = vl;
                });

                calcFunc();
            }

            function calcFunc() {
                let one_arr = [], two_arr = [], three_arr = [], four_arr = [], five_arr = [], six_arr = [], seven_arr = [], eight_arr = [], nine_arr = [];
                let total_income = 0, total_mortgage = 0, total_exp = 0, total_cash_flow = 0;

                let monthly_rent = ins["in_2"];

                ins["in_22"] = monthly_rent * 12;

                let annual_rent = ins["in_22"];

                let initial_amount = ins["in_1"];
                let left_amount = ins["in_1"];

                if(useLoan == "Yes"){
                    initial_amount = ins["in_1"] * ins["in_101"];
                    left_amount = ins["in_1"] - initial_amount;
                }

                $("#in_22").val(nft.format(annual_rent));

                let rows = `
                    <tr>
                        <td>Begin</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td>-$${nft.format(initial_amount)}</td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                `;

                // Expenses 
                let property_tax = ins["in_3"];
                let total_ins = ins["in_4"];
                let hoa_fee = ins["in_5"];
                let maintenance_fee = ins["in_55"];
                let other_cost = ins["in_7"];

                // Mortgage calculations
                let mortgage_amount_mn = 0;
                let mortgage_payment_mn = 0;
                let mortgage_amount_yr = 0;
                let int_arr = [];
                let t_interest = 0;
                let remaining_blnce = 0;

                if(useLoan == "Yes"){
                    mortgage_amount_mn = -1 * PMT(ins["in_102"]/12, ins["in_103"]*12, left_amount);
                    mortgage_payment_mn = mortgage_amount_mn;
                    mortgage_amount_yr = mortgage_amount_mn * 12;
                    
                    int_arr = yearlyInterest(left_amount, mortgage_amount_mn, ins["in_102"]);
                    t_interest = int_arr[0];
                    remaining_blnce = int_arr[1];
                }

                let purchase_price = ins["in_1"];
                let property_value = ins["in_1"];
                let update_purchase_price = ins["in_1"];

                let cash_flow_arr = [];

                for(i = 0; i < ins["in_10"]; i++){
                    let year = i+1;

                    let irr_arr = [];

                    if(i != 0){
                        monthly_rent = monthly_rent + (monthly_rent * ins["in_2_up"]);
                    }

                    let annual_rent = monthly_rent * 12;

                    let annual_income = annual_rent - (annual_rent*ins["in_6"]);
                    
                    annual_income = annual_income - (annual_income*ins["in_66"]);
                    
                    if(i == 0){
                        property_tax = ins["in_3"];
                        total_ins = ins["in_4"];
                        hoa_fee = ins["in_5"];
                        maintenance_fee = ins["in_55"];
                        other_cost = ins["in_7"];
                    } else {
                        property_tax = property_tax + (property_tax * ins["in_3_up"]);
                        total_ins = total_ins + (total_ins * ins["in_4_up"]);
                        hoa_fee = hoa_fee + (hoa_fee * ins["in_5_up"]);
                        maintenance_fee = maintenance_fee + (maintenance_fee * ins["in_55_up"]);
                        other_cost = other_cost + (other_cost * ins["in_7_up"]);
                    }

                    if(i > ins["in_103"] - 1) {
                        mortgage_amount_mn = 0;
                        mortgage_amount_yr = 0
                    }

                    let annual_expense = property_tax + total_ins + hoa_fee + maintenance_fee + other_cost;
                    let cash_flow = annual_income - annual_expense - mortgage_amount_yr;
                    let cash_return = cash_flow/initial_amount;

                    let equity_ac = 0;
                    let int_rate = 0;

                    if(know_sell_price == "Yes"){
                        int_rate = Math.pow((ins["in_8"]/ins["in_1"]),1/ins["in_10"])-1;
                        
                        if(i == 0){
                            if(useLoan == "Yes"){
                                equity_ac = initial_amount + (ins["in_1"]*int_rate)+mortgage_amount_yr-t_interest;                                
                            } else {
                                equity_ac = ins["in_1"] + (ins["in_1"]*int_rate);
                            }
                        } else {
                            if(useLoan == "Yes"){
                                purchase_price = purchase_price + (purchase_price * int_rate);

                                int_arr = yearlyInterest(remaining_blnce, mortgage_amount_mn, ins["in_102"]);
                                t_interest = int_arr[0];
                                remaining_blnce = int_arr[1];

                                equity_ac = seven_arr[i-1] + (purchase_price*int_rate)+mortgage_amount_yr-t_interest;
                            } else {
                                equity_ac = seven_arr[i-1] + (seven_arr[i-1]*int_rate);
                            }
                        }
                    } else {
                        int_rate = ins["in_9"];
                        if(i == 0){
                            if(useLoan == "Yes"){
                                equity_ac = initial_amount + (ins["in_1"]*int_rate)+mortgage_amount_yr-t_interest;              
                            } else {
                                equity_ac = ins["in_1"] + (ins["in_1"]*int_rate);
                            }
                        } else {
                            if(useLoan == "Yes"){
                                purchase_price = purchase_price + (purchase_price * int_rate);

                                int_arr = yearlyInterest(remaining_blnce, mortgage_amount_mn, ins["in_102"]);
                                t_interest = int_arr[0];
                                remaining_blnce = int_arr[1];

                                equity_ac = seven_arr[i-1] + (purchase_price*int_rate)+mortgage_amount_yr-t_interest; 
                            } else {
                                equity_ac = seven_arr[i-1] + (seven_arr[i-1]*int_rate);
                            }
                        }                 
                    }

                    update_purchase_price = update_purchase_price + (update_purchase_price * int_rate);

                    let cash_rcv = equity_ac - (update_purchase_price * ins["in_11"]);
                    
                    irr_arr.push(-1*initial_amount);

                    cash_flow_arr.push(cash_flow);

                    for(y = 0; y <= i; y++){
                        let new_cash_flow = cash_flow_arr[y];

                        if(y == i){
                            new_cash_flow = new_cash_flow + cash_rcv;
                        }
                        irr_arr.push(new_cash_flow);
                    }

                    if(i == (ins["in_10"]-1)){
                        cash_flow = cash_flow + cash_rcv;
                    }

                    let irr_prcnt = calculateIRR(irr_arr);

                    total_income = total_income + annual_income;
                    total_mortgage = total_mortgage + mortgage_amount_yr;
                    total_exp = total_exp + annual_expense;
                    total_cash_flow = total_cash_flow + cash_flow;

                    one_arr.push(year);
                    two_arr.push(annual_income);
                    three_arr.push(0);
                    four_arr.push(annual_expense);
                    five_arr.push(cash_flow);
                    six_arr.push(cash_return);
                    seven_arr.push(equity_ac);
                    eight_arr.push(cash_rcv);
                    nine_arr.push(irr_prcnt);

                    rows = rows + `
                        <tr>
                            <td>${year}</td>
                            <td>$${nft.format(annual_income)}</td>
                            <td>$${nft.format(mortgage_amount_yr)}</td>
                            <td>$${nft.format(annual_expense)}</td>
                            <td>$${nft.format(cash_flow)}</td>
                            <td>${nftd.format(cash_return*100)}%</td>
                            <td>$${nft.format(equity_ac)}</td>
                            <td>$${nft.format(cash_rcv)}</td>
                            <td>${nftd.format(irr_prcnt)}%</td>
                        </tr>
                    `;
                }

                total_cash_flow = total_cash_flow - initial_amount;

                let cash_on_return = total_cash_flow/initial_amount;
                let cap_rate = ((two_arr[0]-four_arr[0])/property_value)  * 100;

                rows = rows + `
                    <tr>
                        <td>Total</td>
                        <td>$${nft.format(total_income)}</td>
                        <td>$${nft.format(total_mortgage)}</td>
                        <td>$${nft.format(total_exp)}</td>
                        <td>$${nft.format(total_cash_flow)}</td>
                        <td>${nftd.format(cash_on_return * 100)}%</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                `;

                //First year income and expense
                let f_income = ins["in_2"];
                let f_mrt_pay = mortgage_payment_mn;
                let f_vc = f_income * ins["in_6"];
                let f_pro_tax = ins["in_3"]/12;
                let f_t_insu = ins["in_4"]/12;
                let f_mnt_cost = ins["in_55"]/12;
                let f_other_cost = ins["in_7"]/12;
                let f_cash_flow = five_arr[0]/12;
                let f_net_income = f_income - (f_vc + f_pro_tax + f_t_insu + f_mnt_cost + f_other_cost);

                $("#rsl_11").text("$" + nftd.format(f_income));
                $("#rsl_21").text("$" + nftd.format(f_mrt_pay));
                $("#rsl_31").text("$" + nftd.format(f_vc));
                $("#rsl_41").text("$" + nftd.format(f_pro_tax));
                $("#rsl_51").text("$" + nftd.format(f_t_insu));
                $("#rsl_61").text("$" + nftd.format(f_mnt_cost));
                $("#rsl_71").text("$" + nftd.format(f_other_cost));
                $("#rsl_81").text("$" + nftd.format(f_cash_flow));
                $("#rsl_91").text("$" + nftd.format(f_net_income));

                $("#rsl_12").text("$" + nftd.format(f_income*12));
                $("#rsl_22").text("$" + nftd.format(f_mrt_pay*12));
                $("#rsl_32").text("$" + nftd.format(f_vc*12));
                $("#rsl_42").text("$" + nftd.format(f_pro_tax*12));
                $("#rsl_52").text("$" + nftd.format(f_t_insu*12));
                $("#rsl_62").text("$" + nftd.format(f_mnt_cost*12));
                $("#rsl_72").text("$" + nftd.format(f_other_cost*12));
                $("#rsl_82").text("$" + nftd.format(f_cash_flow*12));
                $("#rsl_92").text("$" + nftd.format(f_net_income*12));

                if(f_cash_flow < 0) {
                    $("#rsl_81, #rsl_82").css({"color":"red"});
                } else {
                    $("#rsl_81, #rsl_82").css({"color":"white"});
                }

                //rsl_11

                $("#rs_1").text(nftd.format(nine_arr[nine_arr.length - 1])+"%  per year");
                $("#rs_2").text("$" + nftd.format(total_cash_flow));
                $("#rs_3").text(nftd.format(cash_on_return*100)+"%");
                $("#rs_4").text(nftd.format(cap_rate)+"%");
                $("#rs_5").text("$" + nftd.format(total_income));
                $("#rs_6").text("$" + nftd.format(total_exp));
                $("#rs_7").text("$" + nftd.format(total_income-total_exp));
                $("#tb_data").html(rows);
            }

            function yearlyInterest(op_blnc, mn_py, int_rate){
                let i = 0;
                let total_interest = 0;
                let init_blnce = op_blnc;

                for(i = 0; i < 12; i++){
                    let interest = init_blnce*int_rate/12;
                    init_blnce = init_blnce - (mn_py - interest);
                    total_interest = total_interest + interest;
                }

                return [total_interest, init_blnce];
            }

            function PMT(rate, nperiod, pv, fv, type) {
                if (!fv) fv = 0;
                if (!type) type = 0;

                if (rate == 0) return -(pv + fv)/nperiod;

                var pvif = Math.pow(1 + rate, nperiod);
                var pmt = rate / (pvif - 1) * -(pv * pvif + fv);

                if (type == 1) {
                    pmt /= (1 + rate);
                };

                return pmt;
            }

            function calculateIRR(cashFlows) {
                const MAX_ITERATIONS = 100;
                const ACCURACY = 0.00001;

                let irr = 0.1; // Initial guess for the rate of return
                let npv = 0;
                let irrGuess = 0;

                for (let i = 0; i < MAX_ITERATIONS; i++) {
                    npv = 0;
                    for (let j = 0; j < cashFlows.length; j++) {
                    npv += cashFlows[j] / Math.pow(1 + irr, j);
                    }

                    if (Math.abs(npv) < ACCURACY) {
                    return irr * 100; // Convert to percentage
                    }

                    // Adjust the guess for IRR using the Newton-Raphson method
                    irrGuess = irr - npv / calculateNPVDerivative(cashFlows, irr);
                    if (Math.abs(irrGuess - irr) < ACCURACY) {
                        return irrGuess * 100; // Convert to percentage
                    }

                    irr = irrGuess;
                }

                // If no solution is found within the maximum iterations
                return NaN;
            }

            function calculateNPVDerivative(cashFlows, irr) {
                let derivative = 0;
                for (let j = 0; j < cashFlows.length; j++) {
                    derivative -= (j * cashFlows[j]) / Math.pow(1 + irr, j + 1);
                }
                return derivative;
            }

            // const cashFlows = [-1000, 200, 300, 400, 500];
            // const irr = calculateIRR(cashFlows);
            // console.log("IRR: " + irr + "%");

            function removeSign(vl) {
                return Number(vl.replace(/\$|,/g, ''));
            }
        });
    </script>
</body>

</html>