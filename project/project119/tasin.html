<!DOCTYPE html>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <title>Yield calculator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
        }
    </style>
</head>

<body>
<style>
    #mx_cl *,
    ::after,
    ::before {
        box-sizing: border-box;
    }

    #mx_cl {
        line-height: 1.5;
        font-family: inherit;
    }

    #mx_cl .container {
        width: 100%;
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #4a4a4a;
        text-align: left;
    }

    #mx_cl label {
        display: inline-block;
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 0.5rem;
    }

    #mx_cl .row {
        display: -ms-flexbox;
        display: flex;
        -ms-flex-wrap: wrap;
        flex-wrap: wrap;
        margin-right: -15px;
        margin-left: -15px;
    }

    #mx_cl .col-md-1,
    #mx_cl .col-md-10,
    #mx_cl .col-md-11,
    #mx_cl .col-md-12,
    #mx_cl .col-md-2,
    #mx_cl .col-md-3,
    #mx_cl .col-md-4,
    #mx_cl .col-md-5,
    #mx_cl .col-md-6,
    #mx_cl .col-md-7,
    #mx_cl .col-md-8,
    #mx_cl .col-md-9 {
        position: relative;
        width: 100%;
        padding-right: 15px;
        padding-left: 15px;
    }

    #mx_cl .form-group {
        margin-bottom: 1rem;
    }

    #mx_cl .form-control {
        display: block;
        width: 100%;
        height: 38px;
        padding: 0.275rem 0.75rem;
        font-size: 16px;
        font-weight: 400;
        line-height: 1.5;
        color: #4a4a4a;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #dddddd;
        transition: border-color .15s ease-in-out, box-shadow .15s ease-in-out;
    }

    #mx_cl .form-control:focus {
        outline: none;
    }


    #mx_cl table {
        border-collapse: collapse;
    }

    #mx_cl .table {
        width: 100%;
        margin-bottom: 1rem;
        color: #212529;
    }

    #mx_cl .table td,
    #mx_cl .table th {
        padding: .75rem;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
    }

    #mx_cl .text-center {
        text-align: center;
    }

    @media (min-width: 576px) {
        #mx_cl .container {
            max-width: 100%;
        }
    }

    @media (min-width: 768px) {
        #mx_cl .container {
            max-width: 100%;
        }

        #mx_cl .col-md-12 {
            -ms-flex: 0 0 100%;
            flex: 0 0 100%;
            max-width: 100%;
        }

        #mx_cl .col-md-9 {
            -ms-flex: 0 0 75%;
            flex: 0 0 75%;
            max-width: 75%;
        }

        #mx_cl .col-md-8 {
            -ms-flex: 0 0 66.666667%;
            flex: 0 0 66.666667%;
            max-width: 66.666667%;
        }

        #mx_cl .col-md-7 {
            -ms-flex: 0 0 58.33333%;
            flex: 0 0 58.33333%;
            max-width: 58.33333%;
        }

        #mx_cl .col-md-6 {
            -ms-flex: 0 0 50%;
            flex: 0 0 50%;
            max-width: 50%;
        }

        #mx_cl .col-md-5 {
            -ms-flex: 0 0 41.666667%;
            flex: 0 0 41.666667%;
            max-width: 41.666667%;
        }

        #mx_cl .col-md-4 {
            -ms-flex: 0 0 33.333333%;
            flex: 0 0 33.333333%;
            max-width: 33.333333%;
        }

        #mx_cl .col-md-3 {
            -ms-flex: 0 0 25%;
            flex: 0 0 25%;
            max-width: 25%;
        }
    }

    @media (min-width: 992px) {
        #mx_cl .container {
            max-width: 960px;
        }
    }

    @media (min-width: 1200px) {
        #mx_cl .container {
            max-width: 900px;
        }
    }

    #mx_cl .text-right {
        text-align: right;
    }

    #mx_cl .form-group,
    #mx_cl .input-group {
        position: relative;
        margin-bottom: 15px;
    }

    @media (max-width: 768px) {}

    #mx_cl .top-title {
        font-size: 30px;
        color: #000;
    }

    #mx_cl .input-group-text {
        margin-bottom: 0;
        position: absolute;
        right: 9px;
        padding-top: 3px;
        font-size: 1rem;

    }
    #mx_cl .output-box{
        background-color: #f3f3f3;
        padding: 20px;
        text-align: center;
        box-shadow: 0 0 15px #d4d4d4;

    }
    #mx_cl .out-p{
        font-size: 18px;
        font-weight: 600;
    }
    #mx_cl .output-number{
        font-size: 30px;
        margin-top: 25px;
        font-weight: 600;
        color: #008c3c;
    }
    #mx_cl .append-text {
        position: absolute;
        right: 10px;
        bottom: 6px;
    }
    #mx_cl .cal-btn-group {
        display: flex;
    }
    #mx_cl .cal-btn-group button {
        flex-grow: 1;
    }
    #mx_cl .cal-btn {
        display: inline-block;
        font-weight: 400;
        text-align: center;
        white-space: nowrap;
        vertical-align: middle;
        cursor: pointer;
        border: 1px solid transparent;
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        line-height: 1.5;
        transition: color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    #mx_cl .cal-btn-primary {
        color: #008C3C;
        background-color: #ffffff;
        border-color: #008C3C;
        border-right: none;
    }
    #mx_cl .cal-btn-last {
        border-right: 1px solid #008C3C !important;
    }
    #mx_cl .cal-mb {
        margin-bottom: 10px !important;
    }
    #mx_cl .cal-yeild-active {
        color: #fff !important;
        background-color: #008C3C !important;
    }
</style>
<div class="ms-cl" id="mx_cl">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h3 class="top-title text-center">Yield calculator</h3>
            </div>
            <div class="col-md-3">
                <label for="in_1" class="common-p">Market Value Properts</label>
                <div class="input-group">
                    <span class="append-text">€</span>
                    <input type="text" class="form-control text-left cl-in cl-input cl-curr" id="in_1" value="420000">
                </div>
            </div>
            <div class="col-md-3">
                <label for="in_2" class="common-p">Yield p.a.</label>
                <div class="input-group">
                    <span class="append-text">%</span>
                    <input type="text" class="form-control text-left cl-input cl-curr" id="in_2" value="3" min="1" max="100">
                </div>
            </div>
            <div class="col-md-3">
                <label for="in_3" class="common-p">Purchase Price Property</label>
                <div class="input-group">
                    <span class="append-text">€</span>
                    <input type="text" class="form-control text-left cl-in cl-input cl-curr" id="in_3"value="200000">
                </div>
            </div>
            <div class="col-md-3">
                <label for="in_4" class="common-p">Capital value of Usufruct</label>
                <div class="input-group">
                    <span class="append-text">€</span>
                    <input type="text" class="form-control text-left cl-in cl-input cl-curr" id="in_4" value="220000">
                </div>
            </div>
            <div class="col-md-3">
                <label for="">Yield including Usufruct?</label>
                <div class="cal-btn-group">
                    <button class="cal-btn cal-btn-primary cal-mb cal-yeild cal-yeild-active" data-value="1">Yes</button>
                    <button class="cal-btn cal-btn-primary cal-mb cal-yeild cal-btn-last" data-value="0">No</button>
                </div>
                <div class="input-group">
                    
                </div>
            </div>

            <div class="col-md-12">
                <br>
                <div class="output-box" id="rs_sec">
                    <div class="out-p">Yield p.a ⊘</div>
                    <div class="output-number" id="rs_1">0%</div>
                </div>
                <br>
                <div class="row">
                    <div class="col-md-6">
                        <div id="my_chart1"></div>
                    </div>
                    <div class="col-md-6">
                        <div id="my_chart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/autonumeric@4.5.4"></script>
<script>
    jQuery(document).ready(function ($) {
        let one_arr  = [];
        let two_arr  = [];
        let three_arr  = [];
        let four_arr  = [];
        let five_arr  = [];
        let six_arr  = [];
        let seven_arr  = [];
        let eight_arr  = [];
        let nine_arr  = [];
        let nine_arr_g  = [];
        let ten_arr  = [];
        let eleven_arr  = [];
        let twelve_arr  = [];
        let twelve_arr_g  = [];
        let series_arr = [];
        let isYeild = 1;

        let data_arr = [
            0,
            2.83687943262411,
            3.64963503649635,
            3.78787878787879,
            3.93700787401575,
            4.91803278688525,
            4.31034482758621,
            4.50450450450450,
            4.71698113207547,
            5.94059405940594,
            5.26315789473684,
            5.55555555555556
        ]
        const numOptionCurrency = {
            digitGroupSeparator: '.',
            decimalCharacter: ',',
            decimalCharacterAlternative: '.',
            currencySymbol: '',
            currencySymbolPlacement: AutoNumeric.options.currencySymbolPlacement.prefix,
            decimalPlaces: 0,
            minimumValue: 0
        };
        const numOptionPercent = {
            digitGroupSeparator: ',',
            decimalCharacter: '.',
            decimalCharacterAlternative: '.',
            currencySymbol: '',
            currencySymbolPlacement: AutoNumeric.options.currencySymbolPlacement.suffix,
            decimalPlaces: 1,
            minimumValue: 0,
            maximumValue: 100
        };

        const anElement1 = AutoNumeric.multiple('.cl-in', numOptionCurrency);
	    new AutoNumeric('#in_2', numOptionPercent);

        function removeComma(num){
            return Number(num.replace(/,/g,""));
        }
        

        const nftd = Intl.NumberFormat("de-DE", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });

        Calc();


        $(".cal-yeild").on("click", function(){
            $(".cal-yeild").removeClass("cal-yeild-active");
            $(this).addClass("cal-yeild-active");

            isYeild = Number($(this).data("value"));

            if(isYeild) {
               $("#rs_sec").show(); 
            } else {
                $("#rs_sec").hide();
            }
            
            Calc();
        })
        
        $(".cl-input").on("input", function(){
            Calc();
        })

        

        function Calc(){
            in_1 = removeSign($('#in_1').val());
            in_2 = removeSign($('#in_2').val());
            in_3 = removeSign($('#in_3').val());
            in_4 = removeSign($('#in_4').val());

            if(in_1 && in_2 && in_3 && in_4){
                one_arr  = [];
                two_arr  = [];
                three_arr  = [];
                four_arr  = [];
                five_arr  = [];
                six_arr  = [];
                seven_arr  = [];
                eight_arr  = [];
                nine_arr  = [];
                nine_arr_g  = [];
                ten_arr  = [];
                eleven_arr  = [];
                twelve_arr  = [];
                twelve_arr_g  = [];

                let total_am = 0;
                
                for(i = 0; i < 12; i++) {
                    two_vl = 0;
                    three_vl = 0;
                    four_vl = 0;
                    five_vl = 0;
                    six_vl = 0;
                    seven_vl = 0;
                    eight_vl = 0;
                    nine_vl = 0;
                    ten_vl = 0;
                    eleven_vl = 0;
                    twelve_vl = 0;
                    
                    if(i == 0){
                        two_vl = in_4;
                        three_vl = 0;
                        four_vl = 0;
                        five_vl = 0;
                        six_vl = in_1;
                        seven_vl = 0;
                        eight_vl = 0;
                        nine_vl = 0;
                        ten_vl = 0;
                        eleven_vl = 0;
                        twelve_vl = 0;
                    } else {
                        if(i == 1){
                            two_vl = in_4 - (two_arr[i-1] * (data_arr[i]/100));
                        } else {
                            two_vl = two_arr[i-1] - (two_arr[i-1] * (data_arr[i]/100));
                        }

                        three_vl = two_arr[i-1]-two_vl;

                        four_vl = data_arr[i]/100;
                        five_vl = (three_vl/two_arr[i-1])*1;
                        six_vl = six_arr[0]*Math.pow((1.03), i);
                        seven_vl = six_vl-two_vl;
                        eight_vl = six_vl-in_3-two_vl;
                        nine_vl = eight_vl/in_3;

                        if(i == 1){
                            ten_vl = nine_vl;
                        } else if(i == 2) {
                            ten_vl = nine_vl-ten_arr[i-1];
                        } else {
                            ten_vl = nine_vl-nine_arr[i-1];
                        }

                        eleven_vl = six_vl-in_3;
                        twelve_vl = eleven_vl/in_3;
                    } 

                    let x = 0;
                    if(isYeild){
                        x = ten_vl;
                    } else {
                        x = twelve_vl;
                    }
                    
                    total_am = total_am + x;
                    
                    one_arr.push(i);
                    two_arr.push(two_vl);
                    three_arr.push(three_vl);
                    four_arr.push(four_vl);
                    five_arr.push(five_vl);
                    six_arr.push(six_vl);
                    seven_arr.push(seven_vl);
                    eight_arr.push(eight_vl);
                    nine_arr.push(nine_vl);
                    nine_arr_g.push(nine_vl*100);
                    ten_arr.push(ten_vl);
                    eleven_arr.push(eleven_vl);
                    twelve_arr.push(twelve_vl);
                    twelve_arr_g.push(twelve_vl*100);
                }
                

                let avrg = total_am/11;
                

                $("#rs_1").text(nftd.format(avrg*100)+"%");

                Highcharts.setOptions({
                    lang: {
                        thousandsSep: ','
                    }
                });

                Highcharts.chart('my_chart', {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: ''
                    },
                    subtitle: {
                        text: '',
                        style: {
                            display: 'none'
                        }
                    },
                    xAxis: {
                        categories: one_arr
                    },
                    yAxis: {
                        title: {
                            text: ''
                        },
                        labels: {
                            formatter: function() {
                                return  this.value + '%' ;
                            }
                        }
                    },
                    tooltip: {
                        headerFormat: '<span style="font-size:10px">Year: <b>{point.key}</b></span><table>',
                        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                            '<td style="padding:0"><b>{point.y:,.2f}%</b></td></tr>',
                        footerFormat: '</table>',
                        shared: true,
                        useHTML: true
                    },
                    plotOptions: {
                        spline: {
                            marker: {
                                radius: 4,
                                lineColor: '#666666',
                                lineWidth: 1
                            }
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    legend: {
                        enabled: true
                    },
                    series: [{
                        name: 'Yeild in',
                        data: (isYeild) ? nine_arr_g : twelve_arr_g,
                    }]
                });


                Highcharts.chart('my_chart1', {
                    chart: {
                        type: 'column'
                    },
                    title: {
                        text: ''
                    },
                    subtitle: {
                        text: '',
                        style: {
                            display: 'none'
                        }
                    },
                    xAxis: {
                        categories: one_arr
                    },
                    yAxis: {
                        title: {
                            text: ''
                        },
                        labels: {
                            formatter: function() {
                                return '€'+ this.value ;
                            }
                        }
                    },
                    tooltip: {
                        headerFormat: '<span style="font-size:10px">Year: <b>{point.key}</b></span><table>',
                        pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                            '<td style="padding:0"><b>{point.y:,.0f}€</b></td></tr>',
                        footerFormat: '</table>',
                        shared: true,
                        useHTML: true
                    },
                    plotOptions: {
                        spline: {
                            marker: {
                                radius: 4,
                                lineColor: '#666666',
                                lineWidth: 1
                            }
                        }
                    },
                    credits: {
                        enabled: false
                    },
                    legend: {
                        enabled: true
                    },
                    series: [{
                        name: 'Capital value of usufruct',
                        data: two_arr,
                    },{
                        name: 'Market Value',
                        data: six_arr,
                    },{
                        name: 'Yeild',
                        color: '#008C3C',
                        data: (isYeild) ? eight_arr : eleven_arr,
                    }]
                });
            }
        } 
        function removeSign(vl){
            return Number(vl.replace(/\./g,'').replace(/\,/g,'.'));
        }
    });
</script>
</body>

</html>